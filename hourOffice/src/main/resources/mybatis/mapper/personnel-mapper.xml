<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="personnel">


	<sql id="sql_selectAddbook">
		SELECT
		M.MEM_NO AS memNo,
		M.MEM_POSITION AS memPosition,
		M.MEM_NAME AS memName,
		M.MEM_BIRTH AS memBirth,
		M.MEM_ADDRESS AS
		memAddress,
		M.MEM_PHONE AS MEMPHONE,
		M.MEM_TELL AS MEMTELL,
		M.MEM_EMAIL
		AS MEMEMAIL,
		M.MEM_PROFILE AS MEMPROFILE,
		( SELECT
		DEPT_NAME
		FROM
		DEPARTMENT
		WHERE
		DEPT_CODE = M.DEPT_CODE
		) AS deptName
		FROM (SELECT ROW_NUMBER()OVER(ORDER BY
		MEM_JOIN_DATE DESC) AS RNUM,
		MEMBER.* FROM MEMBER) M
	</sql>

	<!-- 사내주소록 쿼리 -->
	<select id="selectAddbook" resultType="Member">
		<include refid="sql_selectAddbook"></include>
		<where>
			AND M.MEM_DEL_YN='N'
		</where>
	</select>

	<!-- 인사정보 쿼리 -->
	<select id="information" resultType="MemDept">
		SELECT
		mem_dept.mem_no as memNo,
		License.lic_Date as licDate
		FROM
		mem_dept
		LEFT OUTER JOIN license ON mem_dept.mem_no = license.mem_no
		LEFT OUTER JOIN career ON mem_dept.mem_no = career.mem_no
		LEFT OUTER JOIN military ON mem_dept.mem_no = military.mem_no
		WHERE
		MEM_DEL_YN='N'
		AND mem_dept.mem_no = #{memNo}
	</select>

	<!-- 사원전체 주소록 검색(서치)쿼리 -->
	<select id="allMemberList" parameterType="hashmap" resultType="Member">
		<include refid="sql_selectAddbook"></include>
		<where> <!-- MAPPER 기능 : 처음 <where> 절은 > and 생략 -->
			<if test="selectBox == 'name'">
				AND m.mem_name LIKE '%'||#{searchText}||'%'
			</if>
			<if test="selectBox == 'dept'">
				AND DEPARTMENT.dept_name LIKE '%'||#{searchText}||'%'
			</if>
			<if test="selectBox == 'position'">
				AND m.mem_position LIKE '%'||#{searchText}||'%'
			</if>
			AND m.RNUM BETWEEN #{start} AND #{end}
		</where>
	</select>


	<select id="selectmyaddbook" resultType="Contact">
		INSERT INTO contact
		VALUES(#{memNo},CONTACT_SEQ.NEXTVAL,#{name},#{company},#{appointment},#{officeNumber},#{ph},#{email},DEFAULT,'N')
		<!-- INSERT INTO CONTACT VALUES(2101001,CONTACT_SEQ.NEXTVAL,'삼성','개발1팀',0212341234,'01011112222','K@NAVER.COM','회사',DEFAULT,'N'); -->
	</select>

</mapper>
